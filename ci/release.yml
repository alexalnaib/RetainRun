trigger:
  branches:
    include:
    - master
  paths:
    include:
    - task/*

resources:
  repositories:
  - repository: RetainRun
    type: github
    name: alexalnaib/RetainRun
    ref: refs/heads/master
    endpoint: alexalnaib

stages:
- stage: Build
  jobs:
  - checkout: RetainRun
  - template: templates/build.yml
    parameters:
      extension: true

- stage: Preview
  dependsOn:
  - Build
  jobs:
  - checkout: RetainRun
  - template: templates/preview.yml
    parameters:
      environmentName: vs-marketplace-con

- stage: Release
  dependsOn:
  - Build
  - Preview
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/master'))
  jobs:
  - checkout: RetainRun
  - template: templates/release.yml
    parameters:
      environmentName: vs-marketplace-con
